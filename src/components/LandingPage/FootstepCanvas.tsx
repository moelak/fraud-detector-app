import React, { useEffect, useRef } from 'react';

const leftFoot = [
  [
    50.8676, -21.7984, 54.16, -23.9175, 57.7781, -25.3108, 61.5797, -24.8238,
    65.0168, -22.691, 65.2274, -19.777, 63.0965, -16.8267, 59.6651, -15.3563,
    56.1222, -14.9226, 52.064, -16.2318, 50.2946, -18.9386,
  ],
  [
    60.1204, -12.4571, 63.9239, -14.9944, 68.7501, -15.7372, 73.1094,
    -14.8785, 76.3606, -12.5598, 77.6864, -9.1812, 75.4626, -5.6732, 71.7989,
    -3.7381, 66.8619, -3.4904, 62.2926, -5.1249, 58.9898, -8.761,
  ],
  [
    65.5741, 1.1797, 69.3777, -1.3576, 74.2039, -2.1003, 78.5631, -1.2416,
    81.8144, 1.0771, 83.1401, 4.4557, 80.9163, 7.9637, 77.2526, 9.8987,
    72.3156, 10.1465, 67.7464, 8.512, 64.4435, 4.8759,
  ],
  [
    65.8992, 15.9173, 69.9769, 12.6358, 76.2523, 11.7363, 81.4733, 12.4776,
    86.0955, 15.5796, 86.9903, 21.4258, 83.8265, 24.973, 79.1835, 27.0648,
    73.6982, 27.2342, 68.4631, 24.973, 64.886, 20.5535,
  ],
  [
    58.4888, 36.0959, 65.7081, 29.8204, 74.1922, 28.3319, 82.7508, 31.0856,
    88.1092, 34.2858, 91.4583, 41.6536, 87.0673, 47.4585, 79.7739, 50.2866,
    71.7363, 50.0633, 64.1452, 47.4585, 60.1264, 42.6955,
  ],
];

const path = [
  56.2, 162.4, 83.4, 172.8, 107.98, 192.87, 121.58, 221.35, 124.81, 256.3,
  141.64, 293.84, 168.83, 311.96, 203.78, 336.56, 238.08, 344.97, 278.21, 341.09,
  316.4, 329.44, 343.59, 310.67, 370.77, 275.72, 359.12, 244.65, 344.23, 207.11,
  355.24, 168.92, 394.07, 137.2, 438.09, 137.85, 487.28, 174.1, 507.99, 221.99,
  513.17, 269.24, 500.87, 318.44, 480.16, 354.68, 453.63, 396.87, 414.14, 427.93,
  372.72, 447.35, 320.29, 442.17, 272.39, 427.93, 218.02, 441.53, 185.66, 472.6,
  160.42, 514.67, 168.23, 557.54, 200.59, 598.97, 232.96, 627.44, 273.09, 651.39,
  320.34, 663.04, 368.23, 663.69, 417.42, 649.45, 460.79, 626.15, 509.34, 593.14,
  530.7, 556.89, 559.93, 517.92, 582.43, 484.12, 597.16, 459.03, 621.03, 438.11,
  651.37, 429.44, 686.37, 432.05, 726.19, 421.69, 748.57, 397.89, 778.63, 367.51,
  792.63, 335.08, 795.46, 294.86, 790.32, 255.27, 776.32, 225.34, 746.37, 192.73,
  713.8, 199.06, 674.31, 207.51, 638.48, 190.31, 613.65, 146.75, 621.6, 103.45,
  665.51, 60.97, 716.18, 48.5, 763.64, 51.24, 810.1, 71.53, 842.41, 97.98, 879.6,
  131.15, 903.68, 175.24, 915.95, 219.32, 902.13, 270.16, 880.14, 315.02, 884.51,
  370.9, 909.77, 407.97, 947.07, 439.85, 990.64, 439.27, 1036.87, 414.23, 1070.33,
  387.05, 1100.61, 351.45, 1119.94, 306.8, 1128.54, 259.67, 1122.67, 208.8,
  1106.89, 162.16, 1082.4, 108.81, 1050.2, 81.73, 1016.63, 46.43,
];

function drawFoot(ctx: CanvasRenderingContext2D, x: number, y: number, angle: number, flip = false) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(angle);
  if (flip) ctx.scale(-1, 1);
  ctx.translate(-50, -20);
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  for (const shape of leftFoot) {
    for (let i = 0; i < shape.length; i += 2) {
      const px = shape[i];
      const py = shape[i + 1];
      if (i === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
  }
  ctx.fill();
  ctx.restore();
}

const FootstepCanvas = () => {
  const canvasRef = useRef<HTMLCanvasElement | null>(null);

  useEffect(() => {
    setTimeout(() => {
      const canvas = canvasRef.current;
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      if (!ctx) return;

      const robot = document.getElementById('footstep-start');
      if (!robot) return;
      const box = robot.getBoundingClientRect();

      const offsetX = box.left + box.width / 2;
      const offsetY = window.scrollY + box.bottom;

      const baseX = path[0];
      const baseY = path[1];

      for (let i = 0; i < path.length; i += 2) {
        path[i] = path[i] - baseX + offsetX;
        path[i + 1] = path[i + 1] - baseY + offsetY;
      }

      for (let i = 2; i < path.length - 2; i += 20) {
        const x1 = path[i];
        const y1 = path[i + 1];
        const x2 = path[i + 2];
        const y2 = path[i + 3];
        const angle = Math.atan2(y2 - y1, x2 - x1);
        const flip = (i / 20) % 2 === 0;
        drawFoot(ctx, x1, y1, angle, flip);
      }
    }, 100);
  }, []);

  return (
    <canvas
      ref={canvasRef}
      width={window.innerWidth}
      height={document.body.scrollHeight}
      style={{
        position: 'absolute',
        top: 0,
        left: 0,
        pointerEvents: 'none',
        zIndex: 2,
      }}
    />
  );
};

export default FootstepCanvas;